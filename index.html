<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>SCP Test Generator</title>
<link rel="icon" type="image/x-icon" href="main/favicon.ico">
<style>
  body {
    font-family: Arial, sans-serif;
    background: #f3f3f3;
    margin: 0;
    padding: 20px;
  }
  h1 { text-align: center; }
  .container {
    max-width: 1000px;
    margin: auto;
    background: white;
    padding: 20px;
    border-radius: 10px;
    box-shadow: 0 0 8px rgba(0,0,0,0.2);
  }
  .section {
    margin-bottom: 20px;
  }
  label {
    font-weight: bold;
    display: block;
    margin-bottom: 5px;
  }
  input, textarea, button {
    font-size: 14px;
    margin: 5px 0;
  }
  input[type="text"] {
    width: 100%;
    padding: 8px;
    box-sizing: border-box;
  }
  textarea {
    width: 100%;
    min-height: 80px;
    resize: none;
    overflow-y: hidden;
    padding: 8px;
    box-sizing: border-box;
  }
  .dynamic-inputs input {
    display: block;
    margin-bottom: 5px;
  }
  .output {
    background: #eee;
    padding: 10px;
    border-radius: 6px;
    white-space: pre-wrap;
  }
  .copy-btn {
    margin-left: 10px;
    font-size: 12px;
  }
  .material-btn {
    margin: 3px;
    padding: 5px 10px;
    border: 1px solid #888;
    border-radius: 6px;
    cursor: pointer;
    background: #ccc;
  }
  .material-btn.selected {
    background: green;
    color: white;
  }
</style>
</head>
<body>
<div class="container">
  <h1>SCP Test Generator</h1>

  <!-- Tab Name -->
  <div class="section">
    <label>Save/Tab Name</label>
    <input id="tabName" type="text" placeholder="Enter tab name and press Enter">
  </div>

  <!-- Basic Info -->
  <div class="section">
    <label>Host</label>
    <input id="host" type="text" placeholder="@Host">

    <label>SCP</label>
    <input id="scp" type="text" placeholder="SCP-###">

    <label>Classification</label>
    <input id="classification" type="text" placeholder="Euclid/Keter/etc">
  </div>

  <!-- Personnel -->
  <div class="section">
    <label>Assistant Researchers</label>
    <div id="assistantResearchers" class="dynamic-inputs"></div>
    <button onclick="addInput('assistantResearchers')">+ Add</button>
  </div>
  <div class="section">
    <label>Security Department</label>
    <div id="securityDept" class="dynamic-inputs"></div>
    <button onclick="addInput('securityDept')">+ Add</button>
  </div>
  <div class="section">
    <label>Medical Department</label>
    <div id="medicalDept" class="dynamic-inputs"></div>
    <button onclick="addInput('medicalDept')">+ Add</button>
  </div>
  <div class="section">
    <label>Class-D Personnel</label>
    <div id="classD" class="dynamic-inputs"></div>
    <button onclick="addInput('classD', true)">+ Add CD</button>
  </div>
  <div class="section">
    <label>Mobile Task Force</label>
    <div id="mtf" class="dynamic-inputs"></div>
    <button onclick="addInput('mtf')">+ Add</button>
  </div>

  <!-- Testing Objective -->
  <div class="section">
    <label>Testing Objective</label>
    <textarea id="goal" placeholder="Clearly state the purpose and goals of the test"></textarea>
  </div>

  <!-- Materials -->
  <div class="section">
    <label>Materials Used</label>
    <div id="materials">
      <button class="material-btn" onclick="toggleMaterial(this)">Handcuffs</button>
      <button class="material-btn" onclick="toggleMaterial(this)">Taser</button>
      <button class="material-btn" onclick="toggleMaterial(this)">UV Flashlight</button>
      <button class="material-btn" onclick="toggleMaterial(this)">Lavender</button>
      <button class="material-btn" onclick="toggleMaterial(this)">Cage</button>
      <button class="material-btn" onclick="toggleMaterial(this)">Water Gun</button>
      <button class="material-btn" onclick="toggleMaterial(this)">Flashlight</button>
      <button class="material-btn" onclick="toggleMaterial(this)">Scrambler Goggles</button>
    </div>
  </div>

  <!-- Timeline -->
  <div class="section">
    <label>Testing Timeline</label>
    <div id="timeline" class="dynamic-inputs"></div>
    <button onclick="addInput('timeline')">+ Add Step</button>
  </div>

  <!-- Observations -->
  <div class="section">
    <label>Observations & Results</label>
    <textarea id="observations" placeholder="Detailed account of what was observed during testing"></textarea>
  </div>

  <!-- Analysis -->
  <div class="section">
    <label>Analysis</label>
    <textarea id="analysis" placeholder="Scientific interpretation of results and their significance"></textarea>
  </div>

  <!-- Approval -->
  <div class="section">
    <label>Approved By</label>
    <input id="approved" type="text" placeholder="@Approver">
  </div>

  <!-- Generate Buttons -->
  <div class="section">
    <button onclick="generateClassD()">Generate Class-D Script</button>
    <button onclick="generateLog()">Generate SCP Log</button>
    <button onclick="copyAll()">Copy Full Log</button>
  </div>

  <!-- Output -->
  <div class="section">
    <h3>Class-D Script</h3>
    <div id="classDOutput" class="output"></div>
  </div>
  <div class="section">
    <h3>Full SCP Log</h3>
    <div id="logOutput" class="output"></div>
  </div>
</div>

<script>
/* Tab renaming */
document.getElementById("tabName").addEventListener("keydown", function(e) {
  if (e.key === "Enter") {
    document.title = this.value || "SCP Test Generator";
  }
});

/* Auto-resize textareas */
function autoResizeTextarea(textarea) {
  textarea.style.height = "auto";
  textarea.style.height = textarea.scrollHeight + "px";
}
["goal","observations","analysis"].forEach(id=>{
  const ta = document.getElementById(id);
  ta.style.overflowY = "hidden";
  ta.addEventListener("input",()=>autoResizeTextarea(ta));
  autoResizeTextarea(ta);
});

/* Dynamic inputs (timeline + personnel) */
function addInput(containerId, isClassD=false) {
  const container = document.getElementById(containerId);
  const input = document.createElement("input");
  input.type = "text";
  if (isClassD) {
    input.placeholder = "CD" + (container.children.length+1) + " - @player";
  } else {
    input.placeholder = "@player";
  }
  input.addEventListener("keydown", function(e){
    if (e.key === "Enter") {
      e.preventDefault();
      addInput(containerId, isClassD);
      container.lastChild.focus();
    }
    if (e.key === "Backspace" && this.value === "") {
      e.preventDefault();
      this.remove();
    }
  });
  container.appendChild(input);
}

/* Materials toggle */
function toggleMaterial(btn) {
  btn.classList.toggle("selected");
}

/* Copy */
function copyText(text) {
  navigator.clipboard.writeText(text);
}

/* Generate Class-D script */
function generateClassD() {
  const scp = document.getElementById("scp").value;
  const goal = document.getElementById("goal").value;
  const lines = [
    `Hello Class-Ds. We will be testing on SCP-${scp}. Please line up.`,
    ``,
    `The goal of today’s test is to ${goal}.`,
    ``,
    `Security personnel will ensure your safety, provided you comply with all instructions.`,
    ``,
    `Any deviation or failure to cooperate will result in immediate termination.`,
    ``,
    `Do you understand?`
  ];
  let html = "";
  lines.forEach(line=>{
    html += `<div>${line} <button class="copy-btn" onclick="copyText('${line.replace(/'/g,"\\'")}')">Copy</button></div>`;
  });
  document.getElementById("classDOutput").innerHTML = html;
}

/* Generate SCP Log */
function generateLog() {
  const host = document.getElementById("host").value;
  const scp = document.getElementById("scp").value;
  const classification = document.getElementById("classification").value;
  const approved = document.getElementById("approved").value;
  const goal = document.getElementById("goal").value;
  const observations = document.getElementById("observations").value;
  const analysis = document.getElementById("analysis").value;

  function collect(containerId, prefix="") {
    const values = Array.from(document.getElementById(containerId).children)
      .map((i,idx)=> i.value ? (prefix ? prefix+(idx+1)+"-"+i.value : i.value) : "")
      .filter(v=>v!=="");
    return values.length ? values.join(", ") : "N/A";
  }

  const assistant = collect("assistantResearchers");
  const security = collect("securityDept");
  const medical = collect("medicalDept");
  const classD = collect("classD","CD");
  const mtf = collect("mtf");

  const timeline = Array.from(document.getElementById("timeline").children)
    .map((i,idx)=> i.value ? `${idx+1}. ${i.value}` : "")
    .filter(v=>v!=="")
    .join("\n> ");

  const materials = Array.from(document.querySelectorAll("#materials .selected"))
    .map(b=>b.innerText)
    .join(", ") || "N/A";

  const today = new Date().toLocaleDateString();

  const log = `**SCP:** ${scp}
**Classification:** ${classification}
**Date:** ${today}

**Personnel:**
> **Lead Researcher:** ${host}
> **Assistant Researchers:** ${assistant}
> **Security Department:** ${security}
> **Medical Department:** ${medical}
> **Class-D Personnel:** ${classD}
> **Mobile Task Force:** ${mtf}
▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬

**Testing Objective:**
> ${goal}

**Materials Used:**
> ${materials}

**Testing Timeline:**
> ${timeline}

**Observations & Results:**
> ${observations}
▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬
**Analysis:**
> ${analysis}
▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬
**Approved By:** ${approved}
**Logged By:** ${host}`;

  document.getElementById("logOutput").innerText = log;
}

/* Copy Full Log */
function copyAll() {
  const text = document.getElementById("logOutput").innerText;
  navigator.clipboard.writeText(text);
}
</script>
</body>
</html>
