<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>SCP Test Generator</title>
<link rel="icon" type="image/x-icon" href="favicon.ico">
<style>
body { font-family: Arial, sans-serif; background: #111; color: #eee; padding: 20px; }
h1,h2 { color: #fff; }
label { display: block; margin-top: 10px; font-weight: bold; }
input, textarea, button { margin-top: 5px; padding: 8px; border-radius: 4px; border: 1px solid #555; background: #222; color: #eee; }
button { cursor: pointer; margin-top: 10px; }
.section { border:1px solid #555; border-radius:6px; padding:15px; margin-top:15px; background:#1a1a1a; }
.row { display: flex; gap:10px; flex-wrap: wrap; }
.row input { flex:1; min-width:100px; }
.output { margin-top:20px; padding:15px; border:1px solid #444; border-radius:6px; background:#1a1a1a; white-space: pre-wrap; max-width:800px; }
.line { margin:10px 0; padding:8px; background:#222; border-radius:4px; display:flex; justify-content:space-between; align-items:center; }
.line span { flex:1; margin-right:10px; }
.copy-btn { background:#444; border:1px solid #666; padding:5px 10px; border-radius:4px; cursor:pointer; color:#eee; }
.timeline-step { display:flex; margin-top:5px; }
.timeline-step input { flex:1; margin-right:5px; }
.material-btn { margin:5px; background:#444; border:1px solid #666; color:#eee; padding:5px 10px; border-radius:4px; cursor:pointer; }
.material-btn.selected { background:#28a745; }
textarea { width: 100%; box-sizing: border-box; min-height:35px; overflow-y:hidden; }
</style>
</head>
<body>
<h1>SCP Test Generator</h1>

<!-- Tab rename -->
<div class="section">
<label>Tab / Save Name (press Enter to set)</label>
<input type="text" id="tabName" placeholder="Enter tab name">
</div>

<!-- Basic Info Row -->
<div class="section row">
  <div style="flex:1;"><label>Host</label><input type="text" id="host" placeholder="@YourName"></div>
  <div style="flex:1;"><label>SCP Number</label><input type="text" id="scp" placeholder="e.g., 096"></div>
  <div style="flex:1;"><label>Classification</label><input type="text" id="class" placeholder="e.g., KETER"></div>
</div>

<!-- Testing Objective & Analysis -->
<div class="section">
  <label>Testing Objective</label>
  <textarea id="goal" placeholder="Clearly state the purpose and goals of the test"></textarea>

  <label>Observations & Results</label>
  <textarea id="observations" placeholder="Detailed account of what was observed during testing"></textarea>

  <label>Analysis</label>
  <textarea id="analysis" placeholder="Scientific interpretation of results and their significance"></textarea>

  <label>Approved By</label>
  <input type="text" id="approved" placeholder="@Approver">
</div>

<!-- Personnel -->
<div class="section">
<h2>Personnel</h2>

<label>Assistant Researchers</label>
<div id="assistantsContainer"></div>

<label>Security Department</label>
<div id="securityContainer"></div>

<label>Medical Department</label>
<div id="medicalContainer"></div>

<label>Class-D Personnel</label>
<div id="classdContainer"></div>
</div>

<!-- Timeline -->
<div class="section">
<h2>Testing Timeline</h2>
<div id="timelineContainer"></div>
</div>

<!-- Materials Used -->
<div class="section">
<h2>Materials Used</h2>
<div id="materialsContainer"></div>
</div>

<button onclick="generateAll()">Generate Outputs</button>

<h2>Class-D Script</h2>
<div id="scriptOutput" class="output" style="display:none;"></div>

<h2>Full SCP Log</h2>
<button onclick="copyAllLog()">Copy All SCP Log</button>
<div id="logOutput" class="output" style="display:none;"></div>

<script>
// Tab rename
document.getElementById('tabName').addEventListener('keydown', function(e){
  if(e.key==='Enter'){ document.title = this.value || 'SCP Test Generator'; this.blur(); }
});

// Auto-resize textareas
['goal','observations','analysis'].forEach(id=>{
  const ta=document.getElementById(id);
  ta.addEventListener('input', ()=>{ ta.style.height='auto'; ta.style.height=ta.scrollHeight+'px'; });
  ta.style.height=ta.scrollHeight+'px';
});

// Timeline step
const timelineContainer=document.getElementById("timelineContainer");
function addTimelineStep(value=""){
  const div=document.createElement("div"); div.className="timeline-step";
  const input=document.createElement("input"); input.type="text"; input.value=value; input.placeholder="Step description";
  input.onkeydown=function(e){
    if(e.key==="Enter"){ e.preventDefault(); addTimelineStep(); this.blur(); timelineContainer.lastChild.querySelector("input").focus(); }
    else if(e.key==="Backspace" && this.value===""){ e.preventDefault(); if(timelineContainer.children.length>1){ timelineContainer.removeChild(div); timelineContainer.lastChild.querySelector("input").focus(); }}
  };
  div.appendChild(input); timelineContainer.appendChild(div); input.focus();
}
addTimelineStep(); // start with one step

// Materials buttons
const materialsList=["Handcuffs","Bandages","Mop","714","034","517","207","178","860","310","035","093","701"];
const materialsContainer=document.getElementById("materialsContainer");
materialsList.forEach(item=>{
  const btn=document.createElement("button"); btn.textContent=item; btn.className="material-btn";
  btn.onclick=()=>{ btn.classList.toggle("selected"); };
  materialsContainer.appendChild(btn);
});
function getSelectedMaterials(){const selected=[]; document.querySelectorAll("#materialsContainer button.selected").forEach(b=>selected.push(b.textContent)); return selected.length>0?selected.join(", "):"N/A";}

// Dynamic Personnel (timeline-style inputs)
function createDynamicInput(containerId, prefix=""){
  const container=document.getElementById(containerId);
  function addInput(value=""){
    const div=document.createElement("div"); div.className="timeline-step";
    const input=document.createElement("input"); input.type="text"; input.value=value; input.placeholder="Enter name";
    input.onkeydown=function(e){
      if(e.key==="Enter"){ e.preventDefault(); addInput(); this.blur(); container.lastChild.querySelector("input").focus(); }
      else if(e.key==="Backspace" && this.value===""){ e.preventDefault(); if(container.children.length>1){ container.removeChild(div); container.lastChild.querySelector("input").focus(); }}
    };
    div.appendChild(input); container.appendChild(div); input.focus();
  }
  addInput(); // start with one box
}
["assistantsContainer","securityContainer","medicalContainer","classdContainer"].forEach(id=>createDynamicInput(id));

// Collect personnel
function collectInputs(containerId,prefix=""){
  const inputs=document.querySelectorAll(`#${containerId} input`);
  const list=[];
  inputs.forEach((inp,i)=>{
    if(inp.value.trim()!==""){
      if(prefix==="CD") list.push(`CD${i+1}-@${inp.value.trim()}`);
      else list.push(inp.value.trim());
    }
  });
  return list.length>0?list.join(", ") : "N/A";
}

// Copy helpers
function copyLine(text){navigator.clipboard.writeText(text);}
function copyAllLog(){navigator.clipboard.writeText(document.getElementById("logOutput").textContent);}

// Generate outputs
function generateAll(){
  const host=document.getElementById("host").value.trim()||"N/A";
  const scp=document.getElementById("scp").value||"###";
  const classification=document.getElementById("class").value||"Unclassified";
  const goal=document.getElementById("goal").value||"[goal not specified]";
  const observations=document.getElementById("observations").value||"N/A";
  const analysis=document.getElementById("analysis").value||"N/A";
  const approved=document.getElementById("approved").value.trim()||"N/A";

  const assistants=collectInputs("assistantsContainer");
  const security=collectInputs("securityContainer");
  const medical=collectInputs("medicalContainer");
  const classd=collectInputs("classdContainer","CD");
  const materials=getSelectedMaterials();

  // timeline
  let timelineSteps=[];
  timelineContainer.querySelectorAll("input").forEach((inp,i)=>{ if(inp.value.trim()!=="") timelineSteps.push(`> ${i+1}. ${inp.value.trim()}`); });
  if(timelineSteps.length===0) timelineSteps=["N/A"];

  // date
  const today=new Date(); const dateStr=today.toLocaleDateString('en-GB');

  // Class-D Script
  const scriptLines=[
    `Hello Class-Ds. We will be testing on SCP-${scp}. Please line up.`,
    `The goal of today’s test is to ${goal}.`,
    `Security personnel will ensure your safety, provided you comply with all instructions.`,
    `Any deviation or failure to cooperate will result in immediate termination.`,
    `Do you understand?`
  ];
  const scriptDiv=document.getElementById("scriptOutput");
  scriptDiv.innerHTML="";
  scriptLines.forEach(line=>{
    const div=document.createElement("div"); div.className="line";
    const span=document.createElement("span"); span.textContent=line;
    const button=document.createElement("button"); button.className="copy-btn"; button.textContent="Copy"; button.onclick=()=>copyLine(line);
    div.appendChild(span); div.appendChild(button); scriptDiv.appendChild(div);
  });
  scriptDiv.style.display="block";

  // SCP Log
  const logText=
`--
**SCP:** SCP-${scp}
**Classification:** ${classification}
**Date:** ${dateStr}

**Personnel:**
> **Lead Researcher:** ${host}
> **Assistant Researchers:** ${assistants}
> **Security Department:** ${security}
> **Medical Department:** ${medical}
> **Class-D Personnel:** ${classd}
▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬

**Testing Objective:**
> ${goal}

**Materials Used:**
> ${materials}

**Testing Timeline:**
${timelineSteps.join("\n")}

**Observations & Results:**
> ${observations}
▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬

**Analysis:**
> ${analysis}
▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬

**Approved By:** ${approved}
**Logged By:** ${host}
--`;

  const logDiv=document.getElementById("logOutput");
  logDiv.textContent=logText; logDiv.style.display="block";
}
</script>
</body>
</html>
